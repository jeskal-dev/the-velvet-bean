---
import type { HTMLAttributes } from "astro/types";
import SpinnerIcon from "../icons/spinner-icon.astro";
import ArrowLeftIcon from "../icons/arrow-left-icon.astro";
import ArrowRightIcon from "../icons/arrow-right-icon.astro";

interface BaseProps {
  variant?:
    | "primary"
    | "secondary"
    | "accent"
    | "destructive"
    | "ghost"
    | "outline";
  size?: "xs" | "sm" | "md" | "lg" | "xl";
  withIcon?: boolean;
  iconPosition?: "left" | "right";
  disabled?: boolean;
  loading?: boolean;
  fullWidth?: boolean;
  rounded?: "sm" | "md" | "lg" | "full";
  animation?: "pulse" | "bounce" | "float" | "none";
}

type Props =
  | (  BaseProps &
      HTMLAttributes<"button">)
  | ({ href: string } & BaseProps & HTMLAttributes<"a">);

// interface Props extends HTMLAttributes<"button"> {
//   variant?:
//     | "primary"
//     | "secondary"
//     | "accent"
//     | "destructive"
//     | "ghost"
//     | "outline";
//   size?: "xs" | "sm" | "md" | "lg" | "xl";
//   withIcon?: boolean;
//   iconPosition?: "left" | "right";
//   disabled?: boolean;
//   loading?: boolean;
//   fullWidth?: boolean;
//   rounded?: "sm" | "md" | "lg" | "full";
//   animation?: "pulse" | "bounce" | "float" | "none";
// }

const {
  variant = "primary",
  size = "md",
  withIcon = false,
  iconPosition = "right",
  disabled = false,
  loading = false,
  fullWidth = false,
  rounded = "md",
  animation = "none",
  class: className,
  ...props
} = Astro.props;

const baseStyles = `
  group relative
  inline-flex items-center justify-center gap-2
  font-medium whitespace-nowrap
  overflow-hidden
  focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-ring
  disabled:pointer-events-none disabled:opacity-60
  motion-safe:transition-all motion-safe:duration-300 motion-safe:ease-out
  transform-gpu
  cursor-pointer
`;

const variantStyles = {
  primary: `
    bg-linear-to-br from-primary to-primary/80
    text-primary-foreground
    hover:from-primary/90 hover:to-primary/70
    hover:shadow-lg hover:shadow-primary/25
    hover:scale-[1.02]
    active:scale-[0.98]
    motion-translate-y-in-1 motion-opacity-in-0
    shadow-md
  `,
  secondary: `
    bg-linear-to-br from-secondary to-secondary/80
    text-secondary-foreground
    hover:from-secondary/90 hover:to-secondary/70
    hover:shadow-lg hover:shadow-secondary/25
    hover:scale-[1.02]
    active:scale-[0.98]
    shadow-sm
  `,
  accent: `
    bg-linear-to-br from-accent to-accent/80
    text-accent-foreground
    hover:from-accent/90 hover:to-accent/70
    hover:shadow-lg hover:shadow-accent/30
    hover:scale-[1.02]
    active:scale-[0.98]
    shadow-md
  `,
  destructive: `
    bg-linear-to-br from-destructive to-destructive/80
    text-destructive-foreground
    hover:from-destructive/90 hover:to-destructive/70
    hover:shadow-lg hover:shadow-destructive/25
    hover:scale-[1.02]
    active:scale-[0.98]
    shadow-md
  `,
  ghost: `
    bg-transparent
    text-foreground hover:bg-muted/50
    hover:scale-[1.02]
    active:scale-[0.98]
    motion-opacity-in-0
  `,
  outline: `
    bg-transparent
    border border-border
    text-foreground
    hover:bg-muted/30 hover:border-primary/50
    hover:scale-[1.02]
    active:scale-[0.98]
    motion-translate-y-in-1
  `,
};

const sizeStyles = {
  xs: "px-2.5 py-1 text-xs gap-1",
  sm: "px-3 py-1.5 text-sm gap-1.5",
  md: "px-5 py-2.5 text-base gap-2",
  lg: "px-6 py-3 text-lg gap-2.5",
  xl: "px-8 py-4 text-xl gap-3",
};

const roundedStyles = {
  sm: "rounded",
  md: "rounded-lg",
  lg: "rounded-xl",
  full: "rounded-full",
};

const animationStyles = {
  pulse: "animate-pulse-subtle",
  bounce: "animate-bounce-subtle",
  float: "animate-float",
  none: "",
};

const getRippleEffect = `
  after:absolute after:inset-0
  after:content-[''] after:bg-linear-to-r after:from-white/0 after:via-white/20 after:to-white/0
  after:translate-x-[-100%] after:skew-x-[-20deg]
  group-hover:after:animate-shimmer
  after:duration-1000
`;
---

{
  'href' in props ? <a
  class:list={[
    baseStyles,
    variantStyles[variant],
    sizeStyles[size],
    roundedStyles[rounded],
    animationStyles[animation],
    fullWidth && "w-full",
    (variant === "primary" || variant === "accent") && getRippleEffect,
    "motion-safe:transition-all motion-safe:duration-300",
    className,
  ]} 
  {...props}
>
  <!-- Loading Spinner -->
  {loading && <SpinnerIcon size="sm" />}

  <!-- Left Icon -->
  {
    withIcon && iconPosition === "left" && !loading && (
      <ArrowLeftIcon
        size="sm"
        class="group-hover:-translate-x-0.5 motion-safe:transition-transform"
      />
    )
  }

  <span class="flex items-center gap-2">
    <slot />
  </span>

  <!-- Right Icon (default) -->
  {
    withIcon && iconPosition === "right" && !loading && (
      <ArrowRightIcon
        size="sm"
        class="group-hover:translate-x-0.5 motion-safe:transition-transform"
      />
    )
  }
</a> : <button
  class:list={[
    baseStyles,
    variantStyles[variant],
    sizeStyles[size],
    roundedStyles[rounded],
    animationStyles[animation],
    fullWidth && "w-full",
    (variant === "primary" || variant === "accent") && getRippleEffect,
    "motion-safe:transition-all motion-safe:duration-300",
    className,
  ]}
  disabled={disabled || loading}
  {...props}
>
  <!-- Loading Spinner -->
  {loading && <SpinnerIcon size="sm" />}

  <!-- Left Icon -->
  {
    withIcon && iconPosition === "left" && !loading && (
      <ArrowLeftIcon
        size="sm"
        class="group-hover:-translate-x-0.5 motion-safe:transition-transform"
      />
    )
  }

  <span class="flex items-center gap-2">
    <slot />
  </span>

  <!-- Right Icon (default) -->
  {
    withIcon && iconPosition === "right" && !loading && (
      <ArrowRightIcon
        size="sm"
        class="group-hover:translate-x-0.5 motion-safe:transition-transform"
      />
    )
  }
</button>
}
