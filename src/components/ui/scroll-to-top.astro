---
import ChevronUpIcon from "../icons/chevron-up-icon.astro";
---

<button
  id="scroll-to-top"
  class="fixed bottom-8 right-8 z-50 p-4 rounded-full bg-primary text-primary-foreground shadow-2xl shadow-primary/20 cursor-pointer translate-y-20 opacity-0 invisible transition-all duration-500 hover:bg-accent hover:text-accent-foreground active:scale-90 group"
  aria-label="Volver arriba"
>
  <div class="relative">
    <ChevronUpIcon
      class="w-6 h-6 group-hover:-translate-y-1 transition-transform"
    />
  </div>
</button>

<script>
  function initScrollToTop() {
    const button = document.getElementById("scroll-to-top");
    if (!button) return;

    const handleScroll = () => {
      if (window.scrollY > 400) {
        button.classList.remove("translate-y-20", "opacity-0", "invisible");
        button.classList.add("translate-y-0", "opacity-80", "visible");
      } else {
        button.classList.add("translate-y-20", "opacity-0", "invisible");
        button.classList.remove("translate-y-0", "opacity-80", "visible");
      }
    };

    const scrollToTop = () => {
      window.scrollTo({
        top: 0,
        behavior: "smooth",
      });
    };

    window.addEventListener("scroll", handleScroll, { passive: true });
    button.addEventListener("click", scrollToTop);

    // Initial check
    handleScroll();
  }

  // Init on load
  initScrollToTop();

  // Re-init after Astro view transitions
  document.addEventListener("astro:after-swap", initScrollToTop);
</script>

<style>
  /* Optional: Pulse effect while visible */
  #scroll-to-top.visible {
    animation: entrance 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  @keyframes entrance {
    from {
      transform: translateY(20px) scale(0.8);
      opacity: 0;
    }
    to {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
  }
</style>
