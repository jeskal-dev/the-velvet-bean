---
import ArrowRightIcon from "../icons/arrow-right-icon.astro";
import Logo from "../icons/logo.astro";
import MenuIcon from "../icons/menu-icon.astro";
import XIcon from "../icons/x-icon.astro";
import ToggleThemeButton from "../ui/toggle-theme-button.astro";

interface Props {
  class?: string;
}

interface NavItem {
  href: string;
  label: string;
}

const navItems: NavItem[] = [
  { href: "/", label: "Inicio" },
  { href: "/about", label: "Nosotros" },
  { href: "/menu", label: "Menú" },
  { href: "/visit", label: "Visítanos" },
];

const currentPath = Astro.url.pathname;
const { class: className } = Astro.props;
---

<header
  id="main-header"
  class:list={[
    "sticky top-0 z-50 w-full",
    "bg-background/80 backdrop-blur-xl",
    "border-b border-border/40",
    "transition-all duration-500",
    className,
  ]}
>
  <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex h-20 items-center justify-between">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-4 group">
        <div
          class="w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center group-hover:scale-110 transition-transform duration-500"
        >
          <Logo class="text-primary" />
        </div>
        <div class="flex flex-col">
          <span
            class="font-serif font-bold text-xl tracking-tight text-foreground group-hover:text-primary transition-colors"
          >
            The Velvet <span class="text-primary italic">Bean</span>
          </span>
          <span
            class="text-[10px] uppercase tracking-[0.2em] text-muted-foreground font-bold leading-none mt-1 hidden sm:block"
          >
            Est. 2024
          </span>
        </div>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-2">
        {
          navItems.map((item) => (
            <a
              href={item.href}
              class:list={[
                "relative px-4 py-2 text-sm font-bold uppercase tracking-widest text-muted-foreground hover:text-foreground transition-all duration-300 group/nav",
                currentPath === item.href && "text-primary",
              ]}
            >
              {item.label}
              <span
                class:list={[
                  "absolute bottom-1 left-4 right-4 h-0.5 bg-primary origin-left transition-transform duration-500",
                  currentPath === item.href
                    ? "scale-x-100"
                    : "scale-x-0 group-hover/nav:scale-x-100",
                ]}
              />
            </a>
          ))
        }
      </div>

      <!-- Actions -->
      <div class="flex items-center gap-4">
        <!-- Theme Toggle -->
        <ToggleThemeButton />

        <!-- CTA Button -->
        <div class="hidden sm:block">
          <a
            href="/menu"
            class="inline-flex items-center gap-3 px-6 py-2.5 rounded-full bg-foreground text-background text-xs font-bold uppercase tracking-widest hover:bg-primary hover:text-primary-foreground hover:shadow-xl hover:shadow-primary/20 hover:-translate-y-0.5 transition-all duration-300 active:scale-95"
          >
            Nuestra Carta
            <ArrowRightIcon size="xs" />
          </a>
        </div>

        <!-- Mobile Menu Button -->
        <button
          type="button"
          id="mobile-menu-button"
          class="md:hidden p-2.5 rounded-2xl bg-muted/50 text-muted-foreground hover:text-foreground transition-colors"
          aria-label="Menú"
        >
          <MenuIcon id="menu-icon-open" class="w-6 h-6" />
          <XIcon id="menu-icon-close" class="w-6 h-6 hidden" />
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div
      id="mobile-menu"
      class="md:hidden hidden pb-8 pt-4 space-y-2 animate-in fade-in slide-in-from-top-4 duration-300"
    >
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class:list={[
              "block px-5 py-4 rounded-2xl text-lg font-serif font-bold transition-all",
              currentPath === item.href
                ? "bg-primary/10 text-primary border-l-4 border-primary"
                : "text-muted-foreground hover:bg-muted/50",
            ]}
          >
            {item.label}
          </a>
        ))
      }
      <a
        href="/menu"
        class="block px-5 py-4 rounded-2xl bg-primary text-primary-foreground text-center font-bold uppercase tracking-widest mt-6"
      >
        Ver Menú Completo
      </a>
    </div>
  </nav>
</header>

<script>
  function initHeader() {
    const button = document.getElementById("mobile-menu-button");
    const menu = document.getElementById("mobile-menu");
    const iconOpen = document.getElementById("menu-icon-open");
    const iconClose = document.getElementById("menu-icon-close");

    if (!button || !menu || !iconOpen || !iconClose) return;

    button.addEventListener("click", () => {
      const isOpen = !menu.classList.contains("hidden");
      menu.classList.toggle("hidden");
      iconOpen.classList.toggle("hidden");
      iconClose.classList.toggle("hidden");
      button.setAttribute("aria-expanded", String(!isOpen));
    });

    const header = document.getElementById("main-header");
    window.addEventListener(
      "scroll",
      () => {
        if (window.scrollY > 20) {
          header?.classList.add("h-16", "border-b");
          header?.querySelector(".container > div")?.classList.remove("h-20");
          header?.querySelector(".container > div")?.classList.add("h-16");
        } else {
          header?.classList.remove("h-16");
          header?.querySelector(".container > div")?.classList.add("h-20");
          header?.querySelector(".container > div")?.classList.remove("h-16");
        }
      },
      { passive: true }
    );
  }

  initHeader();
  document.addEventListener("astro:after-swap", initHeader);
</script>
